<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Ëá™Â∑±Âä®Êâã,RPC,">










<meta name="description" content="ËÉåÊôØgithub ËøôÈáåÊòØËÉåÊôØ  ËÆæËÆ°‰∏éÈÄâÂûãËÆæËÆ°ÊñπÊ°àÊú¨Ê¨°ÂÆûÁé∞ÁöÑRPCÊ°ÜÊû∂Êï¥‰ΩìËÆæËÆ°Â¶Ç‰∏ãÂõæÊâÄÁ§∫(Âü∫Êú¨ÊâÄÊúâÁöÑRPCÊ°ÜÊû∂Êú¨Ë¥®‰∏äÈÉΩÊòØËøôÊ†∑ÁöÑ üòì)  ‰ªé‰∏äÈù¢ÁöÑÂõæÂèØ‰ª•ÁúãÂà∞ÔºåRPCÊ°ÜÊû∂ËÆæËÆ°Âà∞3‰∏™Ê®°ÂùóÔºöÊúçÂä°Á´Ø„ÄÅÊ≥®ÂÜå‰∏≠ÂøÉ‰ª•ÂèäÂÆ¢Êà∑Á´Ø„ÄÇ ÊúçÂä°Á´ØÊòØÊúçÂä°Êèê‰æõÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôÊääÊúçÂä°Ë∑ØÂæÑÊ≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉ‰∏äÈù¢ÂéªÔºåÂÆ¢Êà∑Á´ØÊòØÊúçÂä°Ê∂àË¥πÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôËÆ¢ÈòÖÊ≥®ÂÜå‰∏≠ÂøÉÁõ∏Â∫îËäÇÁÇπÔºåÊãøÂà∞Áõ∏Â∫îÊúçÂä°ËäÇÁÇπ‰πãÂêéÔºåÂÆ¢Êà∑Á´ØÂÜçÁõ¥ËøûÊúçÂä°Á´ØËØ∑Ê±ÇÊúçÂä°„ÄÇ Âú®ËøêË°åÁöÑ">
<meta name="keywords" content="Ëá™Â∑±Âä®Êâã,RPC">
<meta property="og:type" content="article">
<meta property="og:title" content="Ëá™Â∑±Âä®ÊâãÂÜôRPCÊ°ÜÊû∂">
<meta property="og:url" content="http://yoursite.com/2019/04/02/Ëá™Â∑±Âä®ÊâãÂÜôRPC/index.html">
<meta property="og:site_name" content="Â§©ÂáâÂ•Ω‰∏™Áßã">
<meta property="og:description" content="ËÉåÊôØgithub ËøôÈáåÊòØËÉåÊôØ  ËÆæËÆ°‰∏éÈÄâÂûãËÆæËÆ°ÊñπÊ°àÊú¨Ê¨°ÂÆûÁé∞ÁöÑRPCÊ°ÜÊû∂Êï¥‰ΩìËÆæËÆ°Â¶Ç‰∏ãÂõæÊâÄÁ§∫(Âü∫Êú¨ÊâÄÊúâÁöÑRPCÊ°ÜÊû∂Êú¨Ë¥®‰∏äÈÉΩÊòØËøôÊ†∑ÁöÑ üòì)  ‰ªé‰∏äÈù¢ÁöÑÂõæÂèØ‰ª•ÁúãÂà∞ÔºåRPCÊ°ÜÊû∂ËÆæËÆ°Âà∞3‰∏™Ê®°ÂùóÔºöÊúçÂä°Á´Ø„ÄÅÊ≥®ÂÜå‰∏≠ÂøÉ‰ª•ÂèäÂÆ¢Êà∑Á´Ø„ÄÇ ÊúçÂä°Á´ØÊòØÊúçÂä°Êèê‰æõÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôÊääÊúçÂä°Ë∑ØÂæÑÊ≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉ‰∏äÈù¢ÂéªÔºåÂÆ¢Êà∑Á´ØÊòØÊúçÂä°Ê∂àË¥πÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôËÆ¢ÈòÖÊ≥®ÂÜå‰∏≠ÂøÉÁõ∏Â∫îËäÇÁÇπÔºåÊãøÂà∞Áõ∏Â∫îÊúçÂä°ËäÇÁÇπ‰πãÂêéÔºåÂÆ¢Êà∑Á´ØÂÜçÁõ¥ËøûÊúçÂä°Á´ØËØ∑Ê±ÇÊúçÂä°„ÄÇ Âú®ËøêË°åÁöÑ">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://i.loli.net/2019/03/13/5c8891db013c7.png">
<meta property="og:image" content="https://i.loli.net/2019/03/13/5c887437c3249.png">
<meta property="og:image" content="https://i.loli.net/2019/03/13/5c88fda2a1bc6.png">
<meta property="og:image" content="https://i.loli.net/2019/03/16/5c8c9350b9079.png">
<meta property="og:image" content="https://i.loli.net/2019/04/01/5ca1ffd94fe1f.png">
<meta property="og:image" content="https://i.loli.net/2019/04/02/5ca3225d226cd.png">
<meta property="og:updated_time" content="2019-04-02T08:51:34.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Ëá™Â∑±Âä®ÊâãÂÜôRPCÊ°ÜÊû∂">
<meta name="twitter:description" content="ËÉåÊôØgithub ËøôÈáåÊòØËÉåÊôØ  ËÆæËÆ°‰∏éÈÄâÂûãËÆæËÆ°ÊñπÊ°àÊú¨Ê¨°ÂÆûÁé∞ÁöÑRPCÊ°ÜÊû∂Êï¥‰ΩìËÆæËÆ°Â¶Ç‰∏ãÂõæÊâÄÁ§∫(Âü∫Êú¨ÊâÄÊúâÁöÑRPCÊ°ÜÊû∂Êú¨Ë¥®‰∏äÈÉΩÊòØËøôÊ†∑ÁöÑ üòì)  ‰ªé‰∏äÈù¢ÁöÑÂõæÂèØ‰ª•ÁúãÂà∞ÔºåRPCÊ°ÜÊû∂ËÆæËÆ°Âà∞3‰∏™Ê®°ÂùóÔºöÊúçÂä°Á´Ø„ÄÅÊ≥®ÂÜå‰∏≠ÂøÉ‰ª•ÂèäÂÆ¢Êà∑Á´Ø„ÄÇ ÊúçÂä°Á´ØÊòØÊúçÂä°Êèê‰æõÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôÊääÊúçÂä°Ë∑ØÂæÑÊ≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉ‰∏äÈù¢ÂéªÔºåÂÆ¢Êà∑Á´ØÊòØÊúçÂä°Ê∂àË¥πÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôËÆ¢ÈòÖÊ≥®ÂÜå‰∏≠ÂøÉÁõ∏Â∫îËäÇÁÇπÔºåÊãøÂà∞Áõ∏Â∫îÊúçÂä°ËäÇÁÇπ‰πãÂêéÔºåÂÆ¢Êà∑Á´ØÂÜçÁõ¥ËøûÊúçÂä°Á´ØËØ∑Ê±ÇÊúçÂä°„ÄÇ Âú®ËøêË°åÁöÑ">
<meta name="twitter:image" content="https://i.loli.net/2019/03/13/5c8891db013c7.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Âçö‰∏ª'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2019/04/02/Ëá™Â∑±Âä®ÊâãÂÜôRPC/">





  <title>Ëá™Â∑±Âä®ÊâãÂÜôRPCÊ°ÜÊû∂ | Â§©ÂáâÂ•Ω‰∏™Áßã</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Â§©ÂáâÂ•Ω‰∏™Áßã</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            È¶ñÈ°µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Ê†áÁ≠æ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            ÂàÜÁ±ª
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            ÂΩíÊ°£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            ÂÖ≥‰∫é
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/04/02/Ëá™Â∑±Âä®ÊâãÂÜôRPC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Slogen">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/uploads/avatar.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Â§©ÂáâÂ•Ω‰∏™Áßã">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Ëá™Â∑±Âä®ÊâãÂÜôRPCÊ°ÜÊû∂</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂèëË°®‰∫é</span>
              
              <time title="ÂàõÂª∫‰∫é" itemprop="dateCreated datePublished" datetime="2019-04-02T16:51:34+08:00">
                2019-04-02
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">ÂàÜÁ±ª‰∫é</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/‰∏≠Èó¥‰ª∂/" itemprop="url" rel="index">
                    <span itemprop="name">‰∏≠Èó¥‰ª∂</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/04/02/Ëá™Â∑±Âä®ÊâãÂÜôRPC/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/04/02/Ëá™Â∑±Âä®ÊâãÂÜôRPC/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="ËÉåÊôØ"><a href="#ËÉåÊôØ" class="headerlink" title="ËÉåÊôØ"></a>ËÉåÊôØ</h2><p><a href="https://github.com/rio-2607/BeautyRPC" target="_blank" rel="noopener">github</a></p>
<p>ËøôÈáåÊòØËÉåÊôØ</p>
<p><img src="https://i.loli.net/2019/03/13/5c8891db013c7.png" alt="rpc call.png"></p>
<h2 id="ËÆæËÆ°‰∏éÈÄâÂûã"><a href="#ËÆæËÆ°‰∏éÈÄâÂûã" class="headerlink" title="ËÆæËÆ°‰∏éÈÄâÂûã"></a>ËÆæËÆ°‰∏éÈÄâÂûã</h2><h3 id="ËÆæËÆ°ÊñπÊ°à"><a href="#ËÆæËÆ°ÊñπÊ°à" class="headerlink" title="ËÆæËÆ°ÊñπÊ°à"></a>ËÆæËÆ°ÊñπÊ°à</h3><p>Êú¨Ê¨°ÂÆûÁé∞ÁöÑRPCÊ°ÜÊû∂Êï¥‰ΩìËÆæËÆ°Â¶Ç‰∏ãÂõæÊâÄÁ§∫(Âü∫Êú¨ÊâÄÊúâÁöÑRPCÊ°ÜÊû∂Êú¨Ë¥®‰∏äÈÉΩÊòØËøôÊ†∑ÁöÑ üòì)</p>
<p><img src="https://i.loli.net/2019/03/13/5c887437c3249.png" alt="RPC.png"></p>
<p>‰ªé‰∏äÈù¢ÁöÑÂõæÂèØ‰ª•ÁúãÂà∞ÔºåRPCÊ°ÜÊû∂ËÆæËÆ°Âà∞3‰∏™Ê®°ÂùóÔºöÊúçÂä°Á´Ø„ÄÅÊ≥®ÂÜå‰∏≠ÂøÉ‰ª•ÂèäÂÆ¢Êà∑Á´Ø„ÄÇ</p>
<p>ÊúçÂä°Á´ØÊòØÊúçÂä°Êèê‰æõÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôÊääÊúçÂä°Ë∑ØÂæÑÊ≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉ‰∏äÈù¢ÂéªÔºåÂÆ¢Êà∑Á´ØÊòØÊúçÂä°Ê∂àË¥πÊñπÔºåÂú®ÂêØÂä®ÁöÑÊó∂ÂÄôËÆ¢ÈòÖÊ≥®ÂÜå‰∏≠ÂøÉÁõ∏Â∫îËäÇÁÇπÔºåÊãøÂà∞Áõ∏Â∫îÊúçÂä°ËäÇÁÇπ‰πãÂêéÔºåÂÆ¢Êà∑Á´ØÂÜçÁõ¥ËøûÊúçÂä°Á´ØËØ∑Ê±ÇÊúçÂä°„ÄÇ</p>
<p>Âú®ËøêË°åÁöÑËøáÁ®ã‰∏≠ÔºåÊúçÂä°Á´ØËäÇÁÇπÂèØËÉΩ‰ºöÈöèÊó∂ÂèòÂåñ(ÂÆïÊú∫ÔºåÂèëÂ∏ÉÈáçÂêØ)ÔºåÊ≠§Êó∂ÔºåÊ≥®ÂÜå‰∏≠ÂøÉ‰ºöÊääÁõ∏Â∫îÁöÑËäÇÁÇπÂèòÂåñÈÄöÁü•ÂÆ¢Êà∑Á´ØÔºå‰ª•‰æøÂÆ¢Êà∑Á´ØÂÅöËøõ‰∏ÄÊ≠•ÁöÑÂ§ÑÁêÜ„ÄÇ</p>
<p>‰∏Ä‰∏™ÊúÄÂü∫Á°ÄÁöÑRPCÊ°ÜÊû∂Ê∂âÂèäÂà∞4‰∏™Âä®‰ΩúÔºö</p>
<ol>
<li>Ê≥®ÂÜå„ÄÇ</li>
<li>ËÆ¢ÈòÖ„ÄÇ</li>
<li>ÈÄöÁü•„ÄÇ</li>
<li>Áõ¥ËøûË∞ÉÁî®„ÄÇ</li>
</ol>
<p>ÂÖ∂‰∏≠ÂâçÈù¢3‰∏™Âä®‰ΩúÔºöÊ≥®ÂÜåÔºåËÆ¢ÈòÖÂíåÈÄöÁü•ÈÉΩÊòØË∑üÊ≥®ÂÜå‰∏≠ÂøÉ‰∫§‰∫íÁöÑÔºåÊ∂âÂèäÂà∞Ê≥®ÂÜå‰∏≠ÂøÉÁöÑÈÄâÂûã„ÄÇ</p>
<p>Á¨¨Âõõ‰∏™Âä®‰ΩúÁõ¥ËøûË∞ÉÁî®ÂèëÁîüÂú®ÂÆ¢Êà∑Á´Ø‰∏éÊúçÂä°Á´Ø‰πãÈó¥ÔºåËøô‰∏ÄËøáÁ®ãÂèàÂÖ∑‰ΩìÂåÖÂê´Ôºö</p>
<ol>
<li>Êï∞ÊçÆÂ∫èÂàóÂåñ/ÂèçÂ∫èÂàóÂåñ„ÄÇËøôÊ∂âÂèäÂà∞Â∫èÂàóÂåñÊñπÊ°àÁöÑÈÄâÂûã„ÄÇ</li>
<li>ÁΩëÁªúÂçèËÆÆ‰ª•ÂèäÁΩëÁªúÈÄö‰ø°„ÄÇËøôÊ∂âÂèäËá™ÂÆö‰πâÈÄö‰ø°ÂçèËÆÆ‰ª•ÂèäÂ∫ïÂ±ÇÈÄö‰ø°Ê°ÜÊû∂ÁöÑÈÄâÂûã„ÄÇ</li>
</ol>
<h3 id="ÊäÄÊúØÈÄâÂûã"><a href="#ÊäÄÊúØÈÄâÂûã" class="headerlink" title="ÊäÄÊúØÈÄâÂûã"></a>ÊäÄÊúØÈÄâÂûã</h3><h3 id="Ê≥®ÂÜå‰∏≠ÂøÉ"><a href="#Ê≥®ÂÜå‰∏≠ÂøÉ" class="headerlink" title="Ê≥®ÂÜå‰∏≠ÂøÉ"></a>Ê≥®ÂÜå‰∏≠ÂøÉ</h3><p>Ê≥®ÂÜå‰∏≠ÂøÉ‰∏ªË¶ÅÈúÄË¶ÅÊèê‰æõÁöÑËÉΩÂäõÊúâÔºö</p>
<ol>
<li>ÊúçÂä°Ê≥®ÂÜå„ÄÇÊúçÂä°Á´ØËÉΩÂ§üÊääËá™Ë∫´ÁöÑÊúçÂä°Âú∞ÂùÄÊ≥®ÂÜå‰∏äÊù•„ÄÇ</li>
<li>ÊúçÂä°ËÆ¢ÈòÖ„ÄÇÂÆ¢Êà∑Á´ØËÉΩÂ§üËÆ¢ÈòÖÁõ∏Â∫îËäÇÁÇπÔºåËé∑ÂèñÁõ∏Â∫îÊï∞ÊçÆ„ÄÇ</li>
<li>ÂèòÊõ¥ÈÄöÁü•„ÄÇÂú®ÊúçÂä°Á´Ø‰∏éÊ≥®ÂÜå‰∏≠ÂøÉÊñ≠ÂºÄËøûÊé•(‰∏ªÂä®:ÂèëÂ∏ÉÈáçÂêØÔºåË¢´Âä®:ÊúçÂä°ÂÆïÊú∫ÊàñËÄÖÁΩëÁªúÊïÖÈöú)‰πãÂêéËÉΩÂ§üÁ¨¨‰∏ÄÊó∂Èó¥ÈÄöÁü•Âà∞ÂÆ¢Êà∑Á´Ø„ÄÇ</li>
</ol>
<p>Ë¶ÅÊª°Ë∂≥‰∏äÈù¢3‰∏™Âü∫Á°ÄÂäüËÉΩÔºå‰∏öÁïåÈÄöÂ∏∏‰ΩøÁî®ZookeeperÊù•‰Ωú‰∏∫Ê≥®ÂÜå‰∏≠ÂøÉ„ÄÇ</p>
<ol>
<li>ÊúçÂä°Ê≥®ÂÜå„ÄÇÊúçÂä°Á´ØÂæÄÁâπÂÆöÁöÑË∑ØÂæÑÂÜôÂÖ•Êï∞ÊçÆ(ÊúçÂä°Á´ØÂè£ÂíåIPÁ≠â)„ÄÇ</li>
<li>ÊúçÂä°ËÆ¢ÈòÖ„ÄÇÂÆ¢Êà∑Á´ØËØªÂèñÁâπÂÆöË∑ØÂæÑ‰∏ãÁöÑÊï∞ÊçÆ(ÊúçÂä°Á´ØIPÂíåÁ´ØÂè£Á≠â)„ÄÇ</li>
<li>ÂèòÊõ¥ËÆ¢ÈòÖ„ÄÇÂÆ¢Êà∑Á´ØÂú®ÁâπÂÆöÁöÑË∑ØÂæÑ‰∏ãÈù¢Ê∑ªÂä†<code>Watcher</code>ÔºåÂΩìÊåáÂÆöË∑ØÂæÑ‰∏ãÁöÑÊï∞ÊçÆÂèëÁîüÂèòÊõ¥ÔºåZookeeper‰ºö‰∏ªÂä®ÈÄöÁü•Âà∞ÂÆ¢Êà∑Á´Ø„ÄÇ</li>
</ol>
<h3 id="Â∫èÂàóÂåñ-ÂèçÂ∫èÂàóÂåñ"><a href="#Â∫èÂàóÂåñ-ÂèçÂ∫èÂàóÂåñ" class="headerlink" title="Â∫èÂàóÂåñ/ÂèçÂ∫èÂàóÂåñ"></a>Â∫èÂàóÂåñ/ÂèçÂ∫èÂàóÂåñ</h3><p>Â∫èÂàóÂåñÊñπÂºèÂØπÊØî</p>
<ol>
<li>JDKËá™Â∏¶Â∫èÂàóÂåñÊñπÂºè„ÄÇ</li>
<li>GoogleÁöÑProtobuf„ÄÇ</li>
<li>FacebookÁöÑThrift.</li>
</ol>
<p>ÊÄßËÉΩÂØπÊØî„ÄÇ</p>
<h3 id="ÁΩëÁªúÂçèËÆÆ-ÁΩëÁªúÈÄö‰ø°"><a href="#ÁΩëÁªúÂçèËÆÆ-ÁΩëÁªúÈÄö‰ø°" class="headerlink" title="ÁΩëÁªúÂçèËÆÆ/ÁΩëÁªúÈÄö‰ø°"></a>ÁΩëÁªúÂçèËÆÆ/ÁΩëÁªúÈÄö‰ø°</h3><ol>
<li>Thrift</li>
<li>Netty</li>
</ol>
<h3 id="ÈÄâÂûã"><a href="#ÈÄâÂûã" class="headerlink" title="ÈÄâÂûã"></a>ÈÄâÂûã</h3><p>Êú¨Ê¨°ÂÆûÁé∞ÁöÑRPCÊ°ÜÊû∂ÊäÄÊúØÈÄâÂûãÁªìÊûú‰∏∫Ôºö<br>Ê≥®ÂÜå‰∏≠ÂøÉÔºöZookeeper<br>Â∫èÂàóÂåñ/ÂèçÂ∫èÂàóÂåñ: Thrift<br>ÁΩëÁªúÂçèËÆÆ/ÁΩëÁªúÈÄö‰ø°: Thrift</p>
<h2 id="ÂÆûÁé∞"><a href="#ÂÆûÁé∞" class="headerlink" title="ÂÆûÁé∞"></a>ÂÆûÁé∞</h2><h3 id="Ê≥®ÂÜå‰∏≠ÂøÉ-1"><a href="#Ê≥®ÂÜå‰∏≠ÂøÉ-1" class="headerlink" title="Ê≥®ÂÜå‰∏≠ÂøÉ"></a>Ê≥®ÂÜå‰∏≠ÂøÉ</h3><p>‰ΩøÁî®ZookeeperÂÖÖÂΩìÊ≥®ÂÜå‰∏≠ÂøÉÔºåÂ∞±ÊòØË¶ÅÂæÄÁâπÂÆöÁöÑË∑ØÂæÑÂÜôÊï∞ÊçÆ„ÄÇ</p>
<p>Êú¨Ê¨°RPCÊ°ÜÊû∂ÁöÑË∑ØÂæÑÁªìÊûÑ‰∏∫:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/beautyrpc/servicename/[providers,consumers]</span><br></pre></td></tr></table></figure>
<p>ÊâÄÊúâË∑ØÂæÑÈúÄË¶Å‰ª•<code>/beautyrpc</code>ÂºÄÂ§¥(Áîü‰∫ßÁéØÂ¢É‰∏≠ÔºåÂèØËÉΩÂ≠òÂú®Â§ö‰∏™‰∏öÂä°‰ΩøÁî®Âêå‰∏ÄÂ•óZookeeperÈõÜÁæ§ÁöÑÊÉÖÂÜµÔºåÊâÄ‰ª•‰∏çÂêåÁöÑ‰∏öÂä°ÈúÄË¶ÅÊåÇËΩΩÂú®‰∏çÂêåÁöÑË∑üË∑ØÂæÑ‰∏ãÈù¢)</p>
<p><img src="https://i.loli.net/2019/03/13/5c88fda2a1bc6.png" alt="registry.png"></p>
<p>‰ªé‰∏äÂõæÂèØ‰ª•ÁúãÂà∞ÔºåÊ≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉ‰∏äÈù¢ÂéªËá≥Â∞ëÈúÄË¶ÅÊèê‰æõÊúçÂä°ÂêçÁß∞„ÄÅÊúçÂä°Á´Ø/ÂÆ¢Êà∑Á´ØÊú∫Âô®IPÂíåÁ´ØÂè£‰ª•ÂèäÊ≥®ÂÜåÁ±ªÂûã(ÊúçÂä°Ê∂àË¥πËÄÖËøòÊòØÊúçÂä°Êèê‰æõËÄÖ)„ÄÇ</p>
<p>È¶ñÂÖàÂÆö‰πâ‰∏Ä‰∏™Á±ª<code>Service</code>Ë°®Á§∫Ê≥®ÂÜåÁöÑÊï∞ÊçÆÔºåÂÆö‰πâÂ¶Ç‰∏ã:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Service</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String PROVIDER_CATEGORY = <span class="string">"providers"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String CONSUMER_CATEGORY = <span class="string">"consumers"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String host; <span class="comment">// ‰∏ªÊú∫Âú∞ÂùÄ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> port; <span class="comment">// ÊúçÂä°Á´ØÂè£</span></span><br><span class="line">    <span class="keyword">public</span> String name; <span class="comment">// ÊúçÂä°ÂêçÁß∞</span></span><br><span class="line">    <span class="keyword">public</span> String category; <span class="comment">// ÊúçÂä°Á±ªÂà´ÔºöÊúçÂä°Êèê‰æõËÄÖËøòÊòØÊúçÂä°Ê∂àË¥πËÄÖ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Êé•‰∏ãÊù•ÂÆö‰πâÊ≥®ÂÜå‰∏≠ÂøÉ<code>Registry</code>Êé•Âè£ÔºåË°®Á§∫Ê≥®ÂÜå‰∏≠ÂøÉÂ∫îËØ•Êèê‰æõÁöÑËÉΩÂäõ:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Registry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">String <span class="title">getHosts</span><span class="params">()</span></span>; <span class="comment">//  Ëé∑ÂèñÊ≥®ÂÜå‰∏≠ÂøÉÂú∞ÂùÄ</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isAvailable</span><span class="params">()</span></span>; <span class="comment">// Ê≥®ÂÜå‰∏≠ÂøÉÊòØÂê¶ÂèØÁî®</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span></span>; <span class="comment">// ÈîÄÊØÅÊ≥®ÂÜå‰∏≠ÂøÉ</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">register</span><span class="params">(Service service)</span></span>; <span class="comment">// Ê≥®ÂÜåÊúçÂä°</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unregister</span><span class="params">(Service service)</span></span>; <span class="comment">// ÂèñÊ∂àÊ≥®ÂÜå</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(String serviceName, NotifyListener listener)</span></span>; <span class="comment">// ËÆ¢ÈòÖÊúçÂä°ÔºåËé∑ÂèñÊåáÂÆöÊúçÂä°ÂêçÁöÑÊúçÂä°Âô®ËäÇÁÇπÔºåÂπ∂‰∏îÂΩìÂØπÂ∫îËäÇÁÇπÊï∞ÊçÆÂèëÁîüÂèòÂåñÊó∂ÂõûË∞É‰º†ÂÖ•ÁöÑÁõëÂê¨Âô®</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">unsubscribe</span><span class="params">(String serviceName, NotifyListener listener)</span></span>; <span class="comment">// ÂèñÊ∂àËÆ¢ÈòÖ</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂÖ∂‰∏≠<code>NotifyListener</code>Êé•Âè£ÁöÑÂÆö‰πâ‰∏∫</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">NotifyListener</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">notify</span><span class="params">(List&lt;Service&gt; services)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Ê≥®ÂÜå‰∏≠ÂøÉÊé•Âè£Â∑≤ÁªèÂÆö‰πâÂ•Ω‰∫ÜÔºåÊé•‰∏ãÊù•ÈúÄË¶ÅËÄÉËôëÊ≥®ÂÜå‰∏≠ÂøÉÂèØËÉΩ‰ºöÂá∫Áé∞ÁöÑÈóÆÈ¢òÂ∑≤ÁªèÂØπÂ∫îÁöÑËß£ÂÜ≥ÊñπÊ≥ï„ÄÇ</p>
<p>ÈúÄË¶ÅËÄÉËôëÁöÑÈóÆÈ¢òÊúâÔºö</p>
<ol>
<li>‰Ωú‰∏∫Ê≥®ÂÜå‰∏≠ÂøÉÁöÑZookeeperÊåÇ‰∫ÜÊÄé‰πàÂäûÔºü</li>
<li><p>Ê≥®ÂÜå/ÂèñÊ∂àÊ≥®ÂÜå„ÄÅËÆ¢ÈòÖ/ÂèñÊ∂àËÆ¢ÈòÖÁöÑÊó∂ÂÄôÂõ†‰∏∫Êüê‰∫õÂéüÂõ†(ÁΩëÁªúÂéüÂõ†/ZookeeperÂÆïÊú∫Á≠â)Â§±Ë¥•‰∫ÜÊÄé‰πàÂäûÔºü</p>
</li>
<li><p>Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãÔºåÊúçÂä°Á´ØÂêØÂä®ÊúçÂä°Ê≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉÔºåÂÆ¢Êà∑Á´Ø‰ªéÊ≥®ÂÜå‰∏≠ÂøÉËé∑ÂèñÊúçÂä°ËäÇÁÇπÔºåÁõ¥Êé•ÊúçÂä°„ÄÇÂ¶ÇÊûúÊúçÂä°ËäÇÁÇπÊúâÂ§ö‰∏™ÔºåÂàôÊåâÁÖßÊüêÁßçÁ≠ñÁï•ÈÄâÊã©ËäÇÁÇπ„ÄÇ<br>ÂÅáËÆæ‰∏ãÈù¢‰∏Ä‰∏™Âú∫ÊôØÔºöAÁöÑÊúçÂä°‰ª•RPCÁöÑÂΩ¢ÂºèÊèê‰æõÁªôBË∞ÉÁî®ÔºåA„ÄÅBÊ≠£Âú®ËÅîË∞ÉÔºåAÂáÜÂ§áÂú®ÊúçÂä°ÁöÑÂÖ•Âè£Â§ÑÂä†Êñ≠ÁÇπÔºå‰ΩÜÊòØÊñ≠ÁÇπ‰∏ÄÁõ¥Ê≤°ËøõÊù•ÔºåÂêéÊù•ÂèëÁé∞ÊòØÂÖ∂‰ªñ‰∫∫‰πüÂêØÂä®È°πÁõÆÂπ∂Ê≥®ÂÜåÂà∞Ê≥®ÂÜå‰∏≠ÂøÉ‰∏äÈù¢Âπ∂ÂØπÂ§ñÊèê‰æõÊúçÂä°‰∫Ü„ÄÇËØ∑Ê±ÇÊâìÂà∞ÂÖ∂‰ªñ‰∫∫ÁöÑÊúçÂä°‰∏äÈù¢Âéª‰∫Ü(ËøôÊòØËá™Â∑±ÁúüÂÆûÁ¢∞Âà∞ËøáÁöÑ‰∫ãÊÉÖ)„ÄÇÂØπ‰∫éËøôÁßçÂú∫ÊôØÂ∫îËØ•ÊÄé‰πàËß£Ôºü</p>
</li>
</ol>
<p>ÂØπ‰∫éÈóÆÈ¢ò1ÔºåËøô‰∏™ÈóÆÈ¢òÊó†Ëß£ÔºåÁ∫ø‰∏äÁéØÂ¢É‰∏ÄÊó¶ZookeeperÊåÇ‰∫ÜÔºåÂ∫îËØ•‰ºöÊúâÂæàÂ§öÊúçÂä°ÂèóÂà∞ÂΩ±ÂìçÁöÑ„ÄÇÂØπ‰∫éËøô‰∏™ÈóÆÈ¢òÔºåÊàë‰ª¨Ë¶ÅÂÅöÁöÑÂ∞±ÊòØZookeeperÈõÜÁæ§Ë¶ÅÂÅöÂà∞È´òÂèØÁî®ÔºåÁÑ∂ÂêéË¶ÅÂÅöÁõëÊéßÔºåÁ¨¨‰∏ÄÊó∂Èó¥ÂèëÁé∞ÈóÆÈ¢ò„ÄÇ</p>
<p>ÂØπ‰∫éÁ¨¨‰∫å‰∏™ÈóÆÈ¢òÔºåÂèØ‰ª•ÊääÊØèÊ¨°Ê≥®ÂÜå/ËÆ¢ÈòÖÂ§±Ë¥•ÁöÑËäÇÁÇπ‰øùÂ≠òËµ∑Êù•ÔºåÁÑ∂ÂêéÂêéÂè∞ËøêË°å‰∏Ä‰∏™ÂÆöÊó∂‰ªªÂä°ÂéªÈáçËØï„ÄÇ</p>
<p>ÂØπ‰∫éÁ¨¨‰∏â‰∏™ÈóÆÈ¢òÔºåÊúâ‰∏§ÁßçËß£Ê≥ïÔºå‰∏ÄÁßçÊòØÊØèÊ¨°ËÅîË∞ÉÁöÑÊó∂ÂÄôÈÖçÁΩÆÁã¨Á´ãÁöÑ(Ëá™Â∑±ÂÆâË£ÖÁöÑÈùûÂÖ±‰∫´ÁöÑ)ZookeeperÊúçÂä°„ÄÇÁ¨¨‰∫åÁßçÊñπÊ≥ïÊòØRPCÊ°ÜÊû∂ÊîØÊåÅÈùôÊÄÅÊ≥®ÂÜåÂô®ÔºåÂç≥Áî®Êà∑ÂèØ‰ª•ÈÄâÊã©‰∏çÈÄâÁî®ZookeeperÈõÜÁæ§ËÄåÊòØÈááÁî®Áõ¥ËøûÊú¨Âú∞ÈÖçÁΩÆÂ•ΩÁöÑÊúçÂä°Âú∞ÂùÄ„ÄÇ</p>
<p>Êú¨Ê¨°ÂÆûÁé∞ÁöÑRPCÊ°ÜÊû∂ÈááÁî®ÁöÑÊòØÁ¨¨‰∫åÁßçÊñπÊ°à„ÄÇ</p>
<h4 id="AbstractRegistry"><a href="#AbstractRegistry" class="headerlink" title="AbstractRegistry"></a><code>AbstractRegistry</code></h4><p>Êó†ËÆ∫ÊòØÈááÁî®<code>Zookeeper</code>ÁöÑÊ≥®ÂÜå‰∏≠ÂøÉÔºåËøòÊòØÊú¨Âú∞Áõ¥ËøûÁöÑÊ≥®ÂÜå‰∏≠ÂøÉÔºåÈÉΩÈúÄË¶Å‰øùÂ≠òÂ∑≤ÁªèÊ≥®ÂÜå‰∫ÜÁöÑÊúçÂä°‰ª•ÂèäËÆ¢ÈòÖÁöÑÁõëÂê¨Âô®ÔºåÊâÄ‰ª•È¶ñÂÖàÂÆö‰πâ‰∏Ä‰∏™ÊäΩË±°Áà∂Á±ª<code>AbstractRegistry</code>ÔºåËØ•Á±ªÈªòËÆ§ÂÆûÁé∞‰∫Ü<code>Registry</code>Êé•Âè£„ÄÇ</p>
<p>Âú®<code>AbstractRegistry</code>Á±ª‰∏≠ÂÆö‰πâ‰∏â‰∏™ÂèòÈáèÂàÜÂà´Áî®Êù•‰øùÂ≠òÂ∑≤ÁªèÊ≥®ÂÜåÁöÑÊúçÂä°ÔºåÂ∑≤ÁªèËÆ¢ÈòÖÁöÑÁõëÂê¨Âô®‰ª•ÂèäÊ≥®ÂÜå‰∏≠ÂøÉÁöÑÂú∞ÂùÄ:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AbstractRegistry</span> <span class="keyword">implements</span> <span class="title">Registry</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">final</span> Logger logger = LoggerFactory.getLogger(getClass());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Service&gt; registered = <span class="keyword">new</span> ConcurrentHashSet&lt;&gt;(); <span class="comment">// Â∑≤ÁªèÊ≥®ÂÜåÁöÑÊúçÂä°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;String, Set&lt;NotifyListener&gt;&gt; subscribed = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;(); <span class="comment">// Â∑≤ÁªèËÆ¢ÈòÖÁöÑÁõëÂê¨Âô®Ôºåkey‰∏∫ËÆ¢ÈòÖÁöÑË∑ØÂæÑÔºåvalue‰∏∫ÂØπÂ∫îÁöÑÁõëÂê¨Âô®ÂàóË°®</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> String hosts; <span class="comment">// Ê≥®ÂÜå‰∏≠ÂøÉÁöÑÂú∞ÂùÄ„ÄÇZookeeperÂú∞ÂùÄ/Áõ¥ËøûÂú∞ÂùÄ</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Êé•‰∏ãÊù•ÊòØÂú®<code>AbstractRegistry</code>Á±ª‰∏≠ÂÆûÁé∞ÈªòËÆ§ÁöÑËÆ¢ÈòÖ/Ê≥®ÂÜåÁ≠âÊìç‰Ωú„ÄÇ</p>
<p>È¶ñÂÖàÊòØÊ≥®ÂÜå/ÂèñÊ∂àÊ≥®ÂÜåÊìç‰Ωú</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Service service)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (service == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"register service == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.info(<span class="string">"Register: "</span> + service);</span><br><span class="line">    <span class="comment">// Ê∑ªÂä†Âà∞Â∑≤Ê≥®ÂÜåÊúçÂä°ÈõÜÂêà‰∏≠</span></span><br><span class="line">    registered.add(service);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unregister</span><span class="params">(Service service)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (service == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"unregister service == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.info(<span class="string">"Unregister: "</span> + service);</span><br><span class="line">    <span class="comment">// ‰ªéÈõÜÂêà‰∏≠ÁßªÈô§</span></span><br><span class="line">    registered.remove(service);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÈªòËÆ§Êìç‰ΩúÂæàÁÆÄÂçïÔºåÂè™ÊòØÊ∑ªÂä†Âà∞Â∑≤Ê≥®ÂÜåÊúçÂä°ÈõÜÂêà‰∏≠/‰ªéÂ∑≤Ê≥®ÂÜåÊúçÂä°ÈõÜÂêà‰∏≠ÁßªÈô§„ÄÇ</p>
<p>ËÆ¢ÈòÖ‰∏éÂèñÊ∂àËÆ¢ÈòÖ‰πüÊòØ‰∏ÄÊ†∑ÁöÑÊìç‰ΩúÔºöÊ∑ªÂä†Âà∞ÈõÜÂêà‰∏≠/‰ªéÈõÜÂêà‰∏≠ÁßªÈô§Ôºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(String service, NotifyListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (service == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"subscribe service == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (listener == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"subscribe listener == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.info(<span class="string">"Subscribe: "</span> + service);</span><br><span class="line">    Set&lt;NotifyListener&gt; listeners = subscribed.get(service);</span><br><span class="line">    <span class="keyword">if</span> (listeners == <span class="keyword">null</span>) &#123;</span><br><span class="line">        subscribed.putIfAbsent(service, <span class="keyword">new</span> ConcurrentHashSet&lt;&gt;());</span><br><span class="line">        listeners = subscribed.get(service);</span><br><span class="line">    &#125;</span><br><span class="line">    listeners.add(listener);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unsubscribe</span><span class="params">(String service, NotifyListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (service == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"unsubscribe service == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (listener == <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"unsubscribe listener == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    logger.info(<span class="string">"Unsubscribe: "</span> + service);</span><br><span class="line">    Set&lt;NotifyListener&gt; listeners = subscribed.get(service);</span><br><span class="line">    <span class="keyword">if</span> (listeners != <span class="keyword">null</span>) &#123;</span><br><span class="line">        listeners.remove(listener);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂØπ‰∫é<code>destroy()</code>ÊñπÊ≥ïÔºåÂàôÊòØ‰æùÊ¨°ÈÅçÂéÜ<code>registered</code>Âíå<code>subscribed</code>ÂØπË±°ÔºåÊääÂÖ∂‰∏≠ÁöÑÊï∞ÊçÆ‰ªéÂÆπÂô®‰∏≠Âà†Èô§:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">        logger.info(<span class="string">"Destroy registry"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    Set&lt;Service&gt; destroyRegistered = <span class="keyword">new</span> HashSet&lt;&gt;(getRegistered());</span><br><span class="line">    destroyRegistered.forEach(service -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            unregister(service); <span class="comment">// Ë∞ÉÁî®unregister()ÊñπÊ≥ïÂèñÊ∂àÊ≥®ÂÜå</span></span><br><span class="line">            <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">                logger.info(<span class="string">"Destroy unregister service "</span> + service);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">            logger.warn(<span class="string">"Failed to unregister service "</span> + service + <span class="string">" to registry "</span> + getHosts()</span><br><span class="line">                    + <span class="string">" on destroy, cause: "</span> + t.getMessage(), t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    Map&lt;String, Set&lt;NotifyListener&gt;&gt; destroySubscribed = <span class="keyword">new</span> HashMap&lt;&gt;(getSubscribed());</span><br><span class="line">    destroySubscribed.forEach((service,listeners) -&gt; &#123;</span><br><span class="line">        listeners.forEach(listener -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                unsubscribe(service, listener);<span class="comment">// Ë∞ÉÁî®unsubscribe()ÊñπÊ≥ïÂèñÊ∂àËÆ¢ÈòÖ</span></span><br><span class="line">                <span class="keyword">if</span> (logger.isInfoEnabled()) &#123;</span><br><span class="line">                    logger.info(<span class="string">"Destroy unsubscribe service "</span> + service);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123;</span><br><span class="line">                logger.warn(<span class="string">"Failed to unsubscribe service "</span> + service + <span class="string">" to registry "</span> + getHosts()</span><br><span class="line">                        + <span class="string">" on destroy, cause: "</span> + t.getMessage(), t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>getHosts()</code>ÂÆûÁé∞Â¶Ç‰∏ãÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">getHosts</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> hosts;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Registry</code>ÁöÑÁªßÊâøÁ±ªÂõæÂ¶Ç‰∏ãÊâÄÁ§∫:</p>
<p><img src="https://i.loli.net/2019/03/16/5c8c9350b9079.png" alt="Registry.png"></p>
<p>Ê≥®ÂÜå‰∏≠ÂøÉÈÉΩÁªßÊâøËá™<code>AbstractRegistry</code>„ÄÇ</p>
<p>ÂÖàÊù•ÂÆûÁé∞<code>StaticRegistry</code>„ÄÇ</p>
<h4 id="StaticRegistry"><a href="#StaticRegistry" class="headerlink" title="StaticRegistry"></a><code>StaticRegistry</code></h4><p>Ê≠£Â∏∏ÊÉÖÂÜµ‰∏ãÔºå<code>StaticRegistry</code>Âè™Áî®‰∫éÂºÄÂèë/ÊµãËØïÁéØÂ¢ÉÔºåÂΩìÂÆ¢Êà∑Á´ØÂêë<code>StaticRegistry</code>ËÆ¢ÈòÖÊúçÂä°Êó∂Ôºå<code>StaticRegistry</code>Âè™ÊòØÁõ¥Êé•ËøîÂõûÂÆûÁé∞ÈÖçÁΩÆÂ•ΩÁöÑÊúçÂä°Âô®ÈÖçÁΩÆÔºåËØ•ÈÖçÁΩÆÊòØÂú®ÊûÑÈÄ†Ê≥®ÂÜåÂô®ÁöÑÊó∂ÂÄô‰º†ÂÖ•ÁöÑ„ÄÇ</p>
<p>È¶ñÂÖàÂú®<code>StaticRegistry</code>Á±ª‰∏≠ÂÆö‰πâ<code>servers</code>ÂèòÈáè‰øùÂ≠òÈÖçÁΩÆÂ•ΩÁöÑÊúçÂä°Âô®ÁöÑÂú∞ÂùÄÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticRegistry</span> <span class="keyword">extends</span> <span class="title">AbstractRegistry</span> </span>&#123; </span><br><span class="line">	<span class="keyword">private</span> List&lt;Server&gt; servers;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Server</code>Á±ªË°®Á§∫ÊúçÂä°Âô®ÂØπË±°ÔºåÂÆö‰πâÂ¶Ç‰∏ã:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Server</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Server</span><span class="params">(String host, <span class="keyword">int</span> port)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.host = host;</span><br><span class="line">        <span class="keyword">this</span>.port = port;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">StaticRegistry</span><span class="params">(String hosts, <span class="keyword">int</span> heartbeatPeriod)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.hosts = hosts; <span class="comment">// ‰øùÂ≠òËÆæÁΩÆÁöÑÈÖçÁΩÆ</span></span><br><span class="line">    init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>init()</code>ÊñπÊ≥ïËß£Êûê‰º†ÂÖ•ÁöÑÂ≠óÁ¨¶‰∏≤ÂΩ¢ÂºèË°®Á§∫ÁöÑÊúçÂä°Á´ØÂú∞ÂùÄ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    String addrs = getHosts();</span><br><span class="line">    <span class="keyword">if</span> (addrs == <span class="keyword">null</span> || <span class="string">""</span>.equals(addrs.trim())) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"static service address == null"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    parseServer(addrs);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">parseServer</span><span class="params">(String addr)</span> </span>&#123;</span><br><span class="line">    String[] srv = StringUtils.split(addr, <span class="string">','</span>);</span><br><span class="line">    servers = Arrays.stream(srv).map(server -&gt; &#123;</span><br><span class="line">        String[] info = StringUtils.split(server, <span class="string">':'</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Server(info[<span class="number">0</span>], Integer.parseInt(info[<span class="number">1</span>]));</span><br><span class="line">    &#125;).collect(Collectors.toList());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂÆ¢Êà∑Á´ØÈÄöËøá<code>subscribe()</code>ÊñπÊ≥ïËé∑ÂèñÊåáÂÆöÊúçÂä°ÁöÑÊúçÂä°Âô®Âú∞ÂùÄÔºåÂπ∂‰∏îËÆ¢ÈòÖÈÄöÁü•ÔºöÂΩìÊåáÂÆöÊúçÂä°ÁöÑÊúçÂä°Âô®Âú∞ÂùÄÂèëÁîüÂèòÂåñÊó∂‰ºöÂõûË∞ÉÊåáÂÆöÁöÑ<code>NotifyListener</code>„ÄÇ</p>
<p>ÂØπ‰∫é<code>StaticRegistry</code>ÔºåÂÆÉÁöÑ<code>subscribe()</code>ÊñπÊ≥ïÂÆûÁé∞Â¶Ç‰∏ã:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(<span class="keyword">final</span> String service, <span class="keyword">final</span> NotifyListener listener)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.subscribe(service, listener);</span><br><span class="line">    <span class="comment">// ÊääÈÖçÁΩÆÂ•ΩÁöÑÊúçÂä°Âô®ËΩ¨Êç¢ÊàêserviceÂØπË±°ÔºåÁõ¥Êé•Ë∞ÉÁî®Áà∂Á±ªÁöÑnotify()ÊñπÊ≥ï</span></span><br><span class="line">    List&lt;Service&gt; services = servers.stream()</span><br><span class="line">            .map(server -&gt; <span class="keyword">new</span> Service(server.getHost(), server.getPort(), service, Service.PROVIDER_CATEGORY))</span><br><span class="line">            .collect(Collectors.toList());</span><br><span class="line">    notify(service, listener, services);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Èô§‰∫Ü<code>subscribe()</code>ÊñπÊ≥ï‰∏∫Ôºå<code>StaticRegistry</code>Á±ªÁöÑÂÖ∂‰ªñÊñπÊ≥ïÂèØ‰ª•Áõ¥Êé•‰ΩøÁî®Áà∂Á±ª<code>AbstractRegistry</code>ÁöÑÂØπÂ∫îÊñπÊ≥ï„ÄÇ</p>
<h4 id="FailbackRegistry"><a href="#FailbackRegistry" class="headerlink" title="FailbackRegistry"></a><code>FailbackRegistry</code></h4><p>ÂâçÊñáÊèêÂà∞‰∫ÜÔºåÂú®Ê≥®ÂÜå/ÂèñÊ∂àÊ≥®ÂÜåÔºåËÆ¢ÈòÖ/ÂèñÊ∂àËÆ¢ÈòÖ/ÔºåÈÄöÁü•ÁöÑÊó∂ÂÄôÈÉΩÊúâÂèØËÉΩ‰ºöÂá∫Áé∞ÊïÖÈöúÂØºËá¥Â§±Ë¥•ÔºåÊâÄ‰ª•ÈúÄË¶Å‰øùÂ≠òÊâÄÊúâÂ§±Ë¥•ÁöÑËÆ∞ÂΩïÔºåÁÑ∂ÂêéÂÆöÊó∂ÂéªÈáçËØï„ÄÇ<code>FailbackRegistry</code>Á±ªÂ∞±ÊòØÂÆûÁé∞Ëøô‰∏™ÂäüËÉΩÁöÑ„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FailbackRegistry</span> <span class="keyword">extends</span> <span class="title">AbstractRegistry</span> </span>&#123;</span><br><span class="line">    <span class="comment">// ÂÆöÊó∂‰ªªÂä°ÊâßË°åÂô®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ScheduledExecutorService retryExecutor = Executors.newScheduledThreadPool(<span class="number">1</span>, <span class="keyword">new</span> NamedThreadFactory(</span><br><span class="line">            <span class="string">"ThriftRegistryFailedRetryTimer"</span>, <span class="keyword">true</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Â§±Ë¥•ÈáçËØïÂÆöÊó∂Âô®ÔºåÂÆöÊó∂Ê£ÄÊü•ÊòØÂê¶ÊúâËØ∑Ê±ÇÂ§±Ë¥•ÔºåÂ¶ÇÊúâÔºåÊó†ÈôêÊ¨°ÈáçËØï</span></span><br><span class="line">    <span class="keyword">private</span> ScheduledFuture&lt;?&gt; retryFuture;</span><br><span class="line"></span><br><span class="line">	 <span class="comment">// ‰øùÂ≠òÊâÄÊúâÊ≥®ÂÜåÂ§±Ë¥•ÁöÑService</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Service&gt; failedRegistered = <span class="keyword">new</span> ConcurrentHashSet&lt;Service&gt;();</span><br><span class="line">	 <span class="comment">// ‰øùÂ≠òÊâÄÊúâÂèñÊ∂àÊ≥®ÂÜåÂ§±Ë¥•ÁöÑService</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Set&lt;Service&gt; failedUnregistered = <span class="keyword">new</span> ConcurrentHashSet&lt;Service&gt;();</span><br><span class="line">	 </span><br><span class="line">	 <span class="comment">// ‰øùÂ≠òÊâÄÊúâËÆ¢ÈòÖÂ§±Ë¥•ÁöÑÁõëÂê¨Âô®Ôºåkey‰∏∫ËÆ¢ÈòÖÁöÑÊúçÂä°ÂêçÔºåvalue‰∏∫ÂØπÂ∫îÁöÑÈÄöÁü•Âô®</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;String, Set&lt;NotifyListener&gt;&gt; failedSubscribed = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">	 <span class="comment">// ‰øùÂ≠òÊâÄÊúâÂèñÊ∂àËÆ¢ÈòÖÂ§±Ë¥•ÁöÑ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;String, Set&lt;NotifyListener&gt;&gt; failedUnsubscribed = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line">	</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ConcurrentMap&lt;String, Map&lt;NotifyListener, List&lt;Service&gt;&gt;&gt; failedNotified = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> retryPeriod = Constants.DEFAULT_RETRY_PERIOD;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> checkWhenStartup = Constants.DEFAULT_CHECK_WHEN_STARTUP;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>È¶ñÂÖàÂÆö‰πâ‰∏Ä‰∫õÂèòÈáèÊù•‰øùÂ≠òÂ§±Ë¥•ÁöÑËÆ∞ÂΩïÔºåÁÑ∂ÂêéÂÆö‰πâ‰∏Ä‰∏™Á∫øÁ®ãÊ±†(Âçï‰∏™Á∫øÁ®ã)Êù•ÂØπÂ§±Ë¥•ÁöÑËÆ∞ÂΩïÂÅöÂÆöÊó∂ÈáçËØï„ÄÇ</p>
<p>È¶ñÂÖàÊòØ<code>init()</code>ÊñπÊ≥ïÔºåËØ•ÊñπÊ≥ïÁî±ÂÖ∂‰ªñÂú∞ÊñπË∞ÉÁî®Ôºå‰∏ªË¶ÅÂÅöÂàùÂßãÂåñÔºåÂºÄÂêØ‰ªªÂä°Ë∞ÉÂ∫¶ÔºåÂØπ‰∫éÂ§±Ë¥•ÁöÑËÆ∞ÂΩïÂÆöÊó∂ÂéªÂÅöÈáçËØïÂä®‰Ωú„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    logger.debug(<span class="string">"init failback register"</span>);</span><br><span class="line">    <span class="keyword">this</span>.retryFuture = retryExecutor.scheduleWithFixedDelay(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            retry();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// Èò≤Âæ°ÊÄßÂÆπÈîô</span></span><br><span class="line">            logger.error(<span class="string">"Unexpected error occur at failed retry, cause: "</span> + t.getMessage(), t);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, retryPeriod, retryPeriod, TimeUnit.MILLISECONDS);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>retry()</code>ÊñπÊ≥ï‰∏ªË¶ÅÊòØÂØπÂ§±Ë¥•ÁöÑËÆ∞ÂΩïÂÅöÈáçËØïÊìç‰ΩúÔºö</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ÈáçËØïÂ§±Ë¥•ÁöÑÂä®‰Ωú</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">retry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    logger.debug(<span class="string">"registry retry check"</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!failedRegistered.isEmpty()) &#123;</span><br><span class="line">        Set&lt;Service&gt; failed = <span class="keyword">new</span> HashSet&lt;&gt;(failedRegistered);</span><br><span class="line">        <span class="keyword">if</span> (failed.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            logger.info(<span class="string">"Retry register "</span> + failed);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Service service : failed) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                    	 <span class="comment">// ÂØπ‰∫éÊ≥®ÂÜåÂ§±Ë¥•ÁöÑÊúçÂä°ÔºåÈáçÊñ∞ËøõË°åÊ≥®ÂÜå</span></span><br><span class="line">                        doRegister(service);</span><br><span class="line">                        <span class="comment">// Ê≥®ÂÜåÊàêÂäü‰πãÂêé‰ªéÂ§±Ë¥•ËÆ∞ÂΩï‰∏≠Âà†Èô§</span></span><br><span class="line">                        failedRegistered.remove(service);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                        logger.warn(</span><br><span class="line">                                <span class="string">"Failed to retry register "</span> + failed + <span class="string">", waiting for again, cause: "</span></span><br><span class="line">                                        + t.getMessage(), t);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                logger.warn(<span class="string">"Failed to retry register "</span> + failed + <span class="string">", waiting for again, cause: "</span> + t.getMessage(),</span><br><span class="line">                        t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!failedUnregistered.isEmpty()) &#123;</span><br><span class="line">        Set&lt;Service&gt; failed = <span class="keyword">new</span> HashSet&lt;Service&gt;(failedUnregistered);</span><br><span class="line">        <span class="keyword">if</span> (failed.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            logger.info(<span class="string">"Retry unregister "</span> + failed);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Service service : failed) &#123;</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        doUnregister(service);</span><br><span class="line">                        failedUnregistered.remove(service);</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                        logger.warn(</span><br><span class="line">                                <span class="string">"Failed to retry unregister  "</span> + failed + <span class="string">", waiting for again, cause: "</span></span><br><span class="line">                                        + t.getMessage(), t);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                logger.warn(</span><br><span class="line">                        <span class="string">"Failed to retry unregister  "</span> + failed + <span class="string">", waiting for again, cause: "</span> + t.getMessage(),</span><br><span class="line">                        t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!failedSubscribed.isEmpty()) &#123;</span><br><span class="line">        Map&lt;String, Set&lt;NotifyListener&gt;&gt; failed = <span class="keyword">new</span> HashMap&lt;&gt;(failedSubscribed);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Set&lt;NotifyListener&gt;&gt; entry : <span class="keyword">new</span> HashMap&lt;&gt;(failed).entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.getValue() == <span class="keyword">null</span> || entry.getValue().size() == <span class="number">0</span>) &#123;</span><br><span class="line">                failed.remove(entry.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (failed.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            logger.info(<span class="string">"Retry subscribe "</span> + failed);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, Set&lt;NotifyListener&gt;&gt; entry : failed.entrySet()) &#123;</span><br><span class="line">                    String service = entry.getKey();</span><br><span class="line">                    Set&lt;NotifyListener&gt; listeners = entry.getValue();</span><br><span class="line">                    <span class="keyword">for</span> (NotifyListener listener : listeners) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            doSubscribe(service, listener);</span><br><span class="line">                            listeners.remove(listener);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                            logger.warn(</span><br><span class="line">                                    <span class="string">"Failed to retry subscribe "</span> + failed + <span class="string">", waiting for again, cause: "</span></span><br><span class="line">                                            + t.getMessage(), t);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                logger.warn(</span><br><span class="line">                        <span class="string">"Failed to retry subscribe "</span> + failed + <span class="string">", waiting for again, cause: "</span> + t.getMessage(), t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!failedUnsubscribed.isEmpty()) &#123;</span><br><span class="line">        Map&lt;String, Set&lt;NotifyListener&gt;&gt; failed = <span class="keyword">new</span> HashMap&lt;&gt;(failedUnsubscribed);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Set&lt;NotifyListener&gt;&gt; entry : <span class="keyword">new</span> HashMap&lt;&gt;(failed).entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.getValue() == <span class="keyword">null</span> || entry.getValue().size() == <span class="number">0</span>) &#123;</span><br><span class="line">                failed.remove(entry.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (failed.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            logger.info(<span class="string">"Retry unsubscribe "</span> + failed);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Map.Entry&lt;String, Set&lt;NotifyListener&gt;&gt; entry : failed.entrySet()) &#123;</span><br><span class="line">                    String service = entry.getKey();</span><br><span class="line">                    Set&lt;NotifyListener&gt; listeners = entry.getValue();</span><br><span class="line">                    <span class="keyword">for</span> (NotifyListener listener : listeners) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            doUnsubscribe(service, listener);</span><br><span class="line">                            listeners.remove(listener);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                            logger.warn(<span class="string">"Failed to retry unsubscribe "</span> + failed + <span class="string">", waiting for again, cause: "</span></span><br><span class="line">                                    + t.getMessage(), t);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                logger.warn(</span><br><span class="line">                        <span class="string">"Failed to retry unsubscribe "</span> + failed + <span class="string">", waiting for again, cause: "</span> + t.getMessage(),</span><br><span class="line">                        t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!failedNotified.isEmpty()) &#123;</span><br><span class="line">        Map&lt;String, Map&lt;NotifyListener, List&lt;Service&gt;&gt;&gt; failed = <span class="keyword">new</span> HashMap&lt;&gt;(failedNotified);</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Map&lt;NotifyListener, List&lt;Service&gt;&gt;&gt; entry : <span class="keyword">new</span> HashMap&lt;&gt;(failed).entrySet()) &#123;</span><br><span class="line">            <span class="keyword">if</span> (entry.getValue() == <span class="keyword">null</span> || entry.getValue().size() == <span class="number">0</span>) &#123;</span><br><span class="line">                failed.remove(entry.getKey());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (failed.size() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            logger.info(<span class="string">"Retry notify "</span> + failed);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (Map&lt;NotifyListener, List&lt;Service&gt;&gt; values : failed.values()) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (Map.Entry&lt;NotifyListener, List&lt;Service&gt;&gt; entry : values.entrySet()) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            NotifyListener listener = entry.getKey();</span><br><span class="line">                            List&lt;Service&gt; services = entry.getValue();</span><br><span class="line">                            listener.notify(services);</span><br><span class="line">                            values.remove(listener);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                            logger.warn(</span><br><span class="line">                                    <span class="string">"Failed to retry notify "</span> + failed + <span class="string">", waiting for again, cause: "</span></span><br><span class="line">                                            + t.getMessage(), t);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable t) &#123; <span class="comment">// ÂøΩÁï•ÊâÄÊúâÂºÇÂ∏∏ÔºåÁ≠âÂæÖ‰∏ãÊ¨°ÈáçËØï</span></span><br><span class="line">                logger.warn(<span class="string">"Failed to retry notify "</span> + failed + <span class="string">", waiting for again, cause: "</span> + t.getMessage(), t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Service service)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.register(service);</span><br><span class="line">    failedRegistered.remove(service);</span><br><span class="line">    failedUnregistered.remove(service);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// ÂêëÊúçÂä°Âô®Á´ØÂèëÈÄÅÊ≥®ÂÜåËØ∑Ê±Ç</span></span><br><span class="line">        doRegister(service);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        Throwable t = e;</span><br><span class="line">        <span class="comment">// Â¶ÇÊûúÂºÄÂêØ‰∫ÜÂêØÂä®Êó∂Ê£ÄÊµãÔºåÂàôÁõ¥Êé•ÊäõÂá∫ÂºÇÂ∏∏</span></span><br><span class="line">        <span class="keyword">boolean</span> check = isCheckWhenStartup();</span><br><span class="line">        <span class="keyword">if</span> (check) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Failed to register "</span> + service + <span class="string">" to registry cause: "</span></span><br><span class="line">                    + t.getMessage(), t);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.error(<span class="string">"Failed to register "</span> + service + <span class="string">", waiting for retry, cause: "</span> + t.getMessage(), t);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Â∞ÜÂ§±Ë¥•ÁöÑÊ≥®ÂÜåËØ∑Ê±ÇËÆ∞ÂΩïÂà∞Â§±Ë¥•ÂàóË°®ÔºåÂÆöÊó∂ÈáçËØï</span></span><br><span class="line">        failedRegistered.add(service);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂØπ‰∫é<code>register()</code>ÊñπÊ≥ïÔºåË∞ÉÁî®<code>doRegister()</code>ÊñπÊ≥ïÂÆåÊàêÂÖ∑‰ΩìÁöÑÊ≥®ÂÜåÊìç‰ΩúÔºåËØ•ÊñπÊ≥ïÁî±Â≠êÁ±ªÂÆûÁé∞ÔºåËøô‰∏ÄËøáÁ®ã‰∏≠Â¶ÇÊûúÂèëÁîü‰ªª‰ΩïÂºÇÂ∏∏ÔºåÂàôËÆ§‰∏∫Ê≥®ÂÜåÂ§±Ë¥•ÔºåÂ∞ÜÂØπÂ∫îÁöÑ<code>Service</code>ÂØπË±°‰øùÂ≠òÂà∞Â§±Ë¥•ÁöÑËÆ∞ÂΩï‰∏≠Ôºå‰ª•Á≠âÂæÖÂÆöÊó∂‰ªªÂä°ËøõË°åÈáçËØï„ÄÇ</p>
<p>ÂØπ‰∫éÂÖ∂‰ªñÁöÑÂá†‰∏™Êìç‰Ωú(ÂèñÊ∂àÊ≥®ÂÜå/ËÆ¢ÈòÖ/ÂèñÊ∂àËÆ¢ÈòÖ)‰πüÊòØ‰∏ÄÊ†∑ÁöÑÈÅìÁêÜÔºåÈÉΩÊòØË∞ÉÁî®Â≠êÁ±ªÂÆûÁé∞ÁöÑÊñπÊ≥ïÂÆåÊàêÂÖ∑‰ΩìÁöÑÊìç‰ΩúÔºåÂ¶ÇÊûúÂ§±Ë¥•ÂàôËÆ∞ÂΩïÂà∞ÂØπÂ∫îÁöÑÂ§±Ë¥•ËÆ∞ÂΩï‰∏≠ÔºåÁ≠âÂæÖÂÆöÊó∂‰ªªÂä°ÈáçËØï„ÄÇ</p>
<p>Â≠êÁ±ªÈúÄË¶ÅÂÆûÁé∞ÁöÑÊñπÊ≥ïÊúâ:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">FailbackRegistry</span> <span class="keyword">extends</span> <span class="title">AbstractRegistry</span> </span>&#123;</span><br><span class="line">	<span class="comment">// ÂÆåÊàêÂÆûÈôÖÁöÑÊ≥®ÂÜåÊìç‰Ωú</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doRegister</span><span class="params">(Service service)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ÂÆåÊàêÂÆûÈôÖÁöÑÂèñÊ∂àÊ≥®ÂÜåÊìç‰Ωú</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doUnregister</span><span class="params">(Service service)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ÂÆåÊàêÂÆûÈôÖÁöÑËÆ¢ÈòÖÊìç‰Ωú</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doSubscribe</span><span class="params">(String service, NotifyListener listener)</span></span>;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// ÂÆåÊàêÂÆûÈôÖÁöÑÂèñÊ∂àËÆ¢ÈòÖÊìç‰Ωú</span></span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">doUnsubscribe</span><span class="params">(String service, NotifyListener listener)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂØπ‰∫é<code>notify()</code>Êìç‰ΩúÔºåÁõ¥Êé•Ë∞ÉÁî®Áà∂Á±ªÁöÑ<code>nofity()</code>Âç≥ÂèØ:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doNotify</span><span class="params">(String service, NotifyListener listener, List&lt;Service&gt; services)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">super</span>.notify(service, listener, services);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ZookeeperRegistry"><a href="#ZookeeperRegistry" class="headerlink" title="ZookeeperRegistry"></a><code>ZookeeperRegistry</code></h4><p><code>ZookeeperRegistry</code>ÁªßÊâøËá™<code>FailbackRegistry</code>Á±ªÔºåÂÆåÊàêÂÖ∑‰ΩìÁöÑÊìç‰Ωú„ÄÇ</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doRegister</span><span class="params">(Service service)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        zkClient.create(toUrlPath(service), isEphemeral());</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Failed to register "</span> + service + <span class="string">" to zookeeper "</span> + getHosts() + <span class="string">", cause: "</span></span><br><span class="line">                + e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doUnregister</span><span class="params">(Service service)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        zkClient.delete(toUrlPath(service));</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RpcException(<span class="string">"Failed to unregister "</span> + service + <span class="string">" to zookeeper "</span> + getHosts() + <span class="string">", cause: "</span></span><br><span class="line">                + e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ÂØπ‰∫éÊ≥®ÂÜåÊìç‰ΩúÔºå‰∏ªË¶ÅÂ∞±ÊòØÂæÄÁâπÂÆöÁöÑË∑ØÂæÑÂÜôÂÖ•Êï∞ÊçÆÔºåÂèñÊ∂àÊ≥®ÂÜåÂç≥Âà†ÊéâÂØπÂ∫îË∑ØÂæÑÁöÑÊï∞ÊçÆ„ÄÇ</p>
<h3 id="ÊúçÂä°Á´Ø"><a href="#ÊúçÂä°Á´Ø" class="headerlink" title="ÊúçÂä°Á´Ø"></a>ÊúçÂä°Á´Ø</h3><p><img src="https://i.loli.net/2019/04/01/5ca1ffd94fe1f.png" alt="ThriftServer.png"></p>
<h3 id="ÂÆ¢Êà∑Á´Ø"><a href="#ÂÆ¢Êà∑Á´Ø" class="headerlink" title="ÂÆ¢Êà∑Á´Ø"></a>ÂÆ¢Êà∑Á´Ø</h3><p><img src="https://i.loli.net/2019/04/02/5ca3225d226cd.png" alt="CliemtProxy.png"></p>
<h2 id="‰ºòÂåñ"><a href="#‰ºòÂåñ" class="headerlink" title="‰ºòÂåñ"></a>‰ºòÂåñ</h2><p>ËøôÈáåÊòØ‰ºòÂåñ</p>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><p>ËøôÈáåÊòØ‰ΩøÁî®</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>‰∏á‰∏ÄÊâìËµè‰∫ÜÂë¢^_^</div>
  <button id="rewardButton" disable="enable" style="width: 80px;line-height: 38px;text-align: center;font-weight: bold;color: #fff;border-radius: 5px;
margin:0 20px 20px 0;position: relative;overflow: hidden;color: #8c96a0;text-shadow:1px 1px 1px #fff;border:1px solid #dce1e6;box-shadow: 0 1px 2px #fff inset,0 -1px 0 #a8abae inset;background: -webkit-linear-gradient(top,#f2f3f7,#e4e8ec);background: -moz-linear-gradient(top,#f2f3f7,#e4e8ec);background: linear-gradient(top,#f2f3f7,#e4e8ec);" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    ÊâìËµè
  </button>
  <div id="QR" style="display: none;">
    
      <div id="wechat" style="display: inline-block;width:150px;height:150px">
        <img id="wechat_qr" src="/uploads/wechatpay.jpeg" alt="Slogen WeChat Pay">
        <p>WeChat Pay</p>
      </div>
    
    
      <div id="alipay" style="display: inline-block;width:150px;height:150px">
        <img id="alipay_qr" src="/uploads/alipay.jpeg" alt="Slogen Alipay">
        <p>Alipay</p>
      </div>
    
    
  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Ëá™Â∑±Âä®Êâã/" rel="tag"># Ëá™Â∑±Âä®Êâã</a>
          
            <a href="/tags/RPC/" rel="tag"># RPC</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/04/01/Ëá™Â∑±Âä®ÊâãÂÜôÈÖçÁΩÆÁÆ°ÁêÜ‰∏≠Èó¥‰ª∂/" rel="next" title="Ëá™Â∑±Âä®ÊâãÂÜôÈÖçÁΩÆÁÆ°ÁêÜ‰∏≠Èó¥‰ª∂">
                <i class="fa fa-chevron-left"></i> Ëá™Â∑±Âä®ÊâãÂÜôÈÖçÁΩÆÁÆ°ÁêÜ‰∏≠Èó¥‰ª∂
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/10/17/RedisÊ∫êÁ†ÅÂ≠¶‰π†‰πãÊ®°Âùó(‰∏ä)/" rel="prev" title="RedisÊ®°ÂùóÂ≠¶‰π†(‰∏ä):What And How">
                RedisÊ®°ÂùóÂ≠¶‰π†(‰∏ä):What And How <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            ÊñáÁ´†ÁõÆÂΩï
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Á´ôÁÇπÊ¶ÇËßà
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/uploads/avatar.jpeg" alt="Slogen">
            
              <p class="site-author-name" itemprop="name">Slogen</p>
              <p class="site-description motion-element" itemprop="description">‰∏çÈ™Ñ‰∏çË∫ÅÔºåÈü¨ÂÖâÂÖªÊô¶„ÄÇËç£Ëæ±‰∏çÊÉäÔºåÂéöÁßØËñÑÂèë„ÄÇ</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">26</span>
                  <span class="site-state-item-name">Êó•Âøó</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">ÂàÜÁ±ª</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">Ê†áÁ≠æ</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#ËÉåÊôØ"><span class="nav-number">1.</span> <span class="nav-text">ËÉåÊôØ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ËÆæËÆ°‰∏éÈÄâÂûã"><span class="nav-number">2.</span> <span class="nav-text">ËÆæËÆ°‰∏éÈÄâÂûã</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ËÆæËÆ°ÊñπÊ°à"><span class="nav-number">2.1.</span> <span class="nav-text">ËÆæËÆ°ÊñπÊ°à</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÊäÄÊúØÈÄâÂûã"><span class="nav-number">2.2.</span> <span class="nav-text">ÊäÄÊúØÈÄâÂûã</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Ê≥®ÂÜå‰∏≠ÂøÉ"><span class="nav-number">2.3.</span> <span class="nav-text">Ê≥®ÂÜå‰∏≠ÂøÉ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Â∫èÂàóÂåñ-ÂèçÂ∫èÂàóÂåñ"><span class="nav-number">2.4.</span> <span class="nav-text">Â∫èÂàóÂåñ/ÂèçÂ∫èÂàóÂåñ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÁΩëÁªúÂçèËÆÆ-ÁΩëÁªúÈÄö‰ø°"><span class="nav-number">2.5.</span> <span class="nav-text">ÁΩëÁªúÂçèËÆÆ/ÁΩëÁªúÈÄö‰ø°</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÈÄâÂûã"><span class="nav-number">2.6.</span> <span class="nav-text">ÈÄâÂûã</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ÂÆûÁé∞"><span class="nav-number">3.</span> <span class="nav-text">ÂÆûÁé∞</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Ê≥®ÂÜå‰∏≠ÂøÉ-1"><span class="nav-number">3.1.</span> <span class="nav-text">Ê≥®ÂÜå‰∏≠ÂøÉ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AbstractRegistry"><span class="nav-number">3.1.1.</span> <span class="nav-text">AbstractRegistry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StaticRegistry"><span class="nav-number">3.1.2.</span> <span class="nav-text">StaticRegistry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#FailbackRegistry"><span class="nav-number">3.1.3.</span> <span class="nav-text">FailbackRegistry</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ZookeeperRegistry"><span class="nav-number">3.1.4.</span> <span class="nav-text">ZookeeperRegistry</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÊúçÂä°Á´Ø"><span class="nav-number">3.2.</span> <span class="nav-text">ÊúçÂä°Á´Ø</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ÂÆ¢Êà∑Á´Ø"><span class="nav-number">3.3.</span> <span class="nav-text">ÂÆ¢Êà∑Á´Ø</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#‰ºòÂåñ"><span class="nav-number">4.</span> <span class="nav-text">‰ºòÂåñ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Demo"><span class="nav-number">5.</span> <span class="nav-text">Demo</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Slogen</span>

  
</div>


  <div class="powered-by">Áî± <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> Âº∫ÂäõÈ©±Âä®</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">‰∏ªÈ¢ò &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a></div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  










  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'Bb4EcKhqq3La7xJ59ip4Yv8W-gzGzoHsz',
        appKey: 'LpDWAjNpYUPqyA8rRfxDqfKD',
        placeholder: 'ÊåáÁÇπÊ±üÂ±±ÔºåÊøÄÊâ¨ÊñáÂ≠ó',
        avatar:'mm',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>



  





  

  

  

  
  

  

  

  

</body>
</html>
